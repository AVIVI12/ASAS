<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemini Chat Pro ✨</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
body { background-color: #0f0f0f; font-family: 'Assistant', sans-serif; }
::-webkit-scrollbar { width:6px; }
::-webkit-scrollbar-thumb { background:#444; border-radius:10px; }
.bubble { border-radius: 1rem; padding: 12px 16px; word-wrap: break-word; max-width: 70%; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
.user { background-color: #2563eb; color: white; text-align: right; }
.model { background-color: #1f2937; color: #e5e7eb; text-align: right; border: 1px solid #374151; }
pre { background-color: #111827; padding: 12px; border-radius: 0.75rem; overflow-x: auto; position: relative; text-align: right; }
.copy-btn { position: absolute; top: 6px; left: 6px; background: #374151; color: #f9fafb; font-size: 0.75rem; padding: 2px 6px; border-radius: 0.25rem; cursor: pointer; }
.copy-btn:hover { background: #4b5563; }
</style>
</head>

<body class="flex flex-col h-screen text-white">

<header class="p-4 border-b border-gray-800 flex justify-between items-center bg-[#111]">
<h1 class="font-bold text-lg">Gemini Chat Pro ✨</h1>
<div class="flex gap-2 items-center">
<input id="apiKey" type="password" placeholder="API Key"
class="bg-gray-800 border border-gray-700 rounded px-3 py-2 text-xs w-52">
<select id="model" class="bg-gray-800 border border-gray-700 rounded px-3 py-2 text-xs">
<option value="gemini-2.5-flash" selected>Gemini 2.5 Flash</option>
<option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
<option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
</select>
</div>
</header>

<main id="chat" class="flex-1 overflow-y-auto p-6 space-y-4 flex flex-col"></main>

<footer class="p-4 border-t border-gray-800 flex gap-2 bg-[#111]">
<input id="input" type="text" placeholder="כתוב הודעה..." class="flex-1 bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-sm focus:outline-none">
<button onclick="sendMessage()" class="bg-white text-black px-5 py-3 rounded-xl font-semibold hover:opacity-90 transition">שלח</button>
</footer>

<script>
const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");

inputEl.addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});

function addMessage(role, content) {
  const wrapper = document.createElement("div");
  wrapper.className = role === "user" ? "flex justify-end" : "flex justify-start";
  const bubble = document.createElement("div");
  bubble.className = role === "user" ? "bubble user" : "bubble model";
  renderContent(bubble, content);
  wrapper.appendChild(bubble);
  chatEl.appendChild(wrapper);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function renderContent(container, text) {
  if (text.includes("```")) {
    const parts = text.split("```");
    parts.forEach((part, i) => {
      if (i % 2 === 0) {
        if (part.trim()) {
          const div = document.createElement("div");
          div.innerHTML = marked.parse(part.trim());
          div.style.textAlign = "right";
          container.appendChild(div);
        }
      } else {
        const codeBlock = document.createElement("div");
        codeBlock.className = "relative mt-3";
        const pre = document.createElement("pre");
        pre.innerText = part.trim();
        const copyBtn = document.createElement("button");
        copyBtn.innerText = "העתק";
        copyBtn.className = "copy-btn";
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(part.trim());
          copyBtn.innerText = "הועתק ✔";
          setTimeout(() => copyBtn.innerText = "העתק", 2000);
        };
        codeBlock.appendChild(copyBtn);
        codeBlock.appendChild(pre);
        container.appendChild(codeBlock);
      }
    });
  } else {
    container.innerHTML = marked.parse(text);
    container.style.textAlign = "right";
  }
}

async function sendMessage() {
  const key = document.getElementById("apiKey").value.trim();
  const model = document.getElementById("model").value;
  const text = inputEl.value.trim();
  if (!key) return alert("הכנס API Key");
  if (!text) return;

  addMessage("user", text);
  inputEl.value = "";

  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${model}:generateContent?key=${key}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ parts: [{ text }] }] })
    });

    if (!response.ok) throw new Error("HTTP " + response.status);
    const data = await response.json();
    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text;
    if (!reply) throw new Error("תגובה לא תקינה");
    addMessage("model", reply);
  } catch (err) {
    addMessage("model", "שגיאה: " + err.message);
  }
}
</script>

</body>
</html>
