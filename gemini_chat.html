<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemini Royale ✨</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-black text-white min-h-screen flex flex-col">

<header class="p-4 border-b border-gray-800 flex justify-between items-center">
    <h1 class="text-lg font-bold">Gemini Royale ✨</h1>

    <div class="flex gap-2 items-center">
        <input id="apiKey" type="password"
            placeholder="הכנס API Key"
            class="bg-gray-900 border border-gray-700 rounded px-3 py-2 text-xs w-48">

        <select id="model"
            class="bg-gray-900 border border-gray-700 rounded px-3 py-2 text-xs">

            <option value="gemini-2.5-flash" selected>
                Gemini 2.5 Flash (Text)
            </option>

            <option value="gemini-2.5-pro">
                Gemini 2.5 Pro
            </option>

            <option value="gemini-2.5-flash-lite">
                Gemini 2.5 Flash Lite
            </option>

            <option value="gemini-2.5-flash-image">
                Gemini 2.5 Flash Image (Images)
            </option>

        </select>
    </div>
</header>

<main id="chat" class="flex-1 overflow-y-auto p-4 space-y-4"></main>

<footer class="p-4 border-t border-gray-800 flex gap-2">
    <input id="input" type="text"
        placeholder="כתוב הודעה..."
        class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm">

    <button onclick="sendMessage()"
        class="bg-white text-black px-4 py-2 rounded font-semibold">
        שלח
    </button>
</footer>

<script>
async function sendMessage() {

    const key = document.getElementById("apiKey").value.trim();
    const model = document.getElementById("model").value;
    const inputEl = document.getElementById("input");
    const text = inputEl.value.trim();
    const chat = document.getElementById("chat");

    if (!key) {
        alert("הכנס API Key");
        return;
    }

    if (!text) return;

    addMessage("user", text);
    inputEl.value = "";

    const url = `https://generativelanguage.googleapis.com/v1/models/${model}:generateContent?key=${key}`;

    try {
        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                contents: [{
                    parts: [{ text }]
                }]
            })
        });

        if (!response.ok) {
            throw new Error("HTTP " + response.status);
        }

        const data = await response.json();

        const part = data.candidates?.[0]?.content?.parts?.[0];
        if (!part) throw new Error("תגובה לא תקינה");

        if (part.text) {
            addMessage("model", part.text);
        }

        else if (part.inline_data) {
            addImage(part.inline_data.mime_type, part.inline_data.data);
        }

        else {
            addMessage("model", "פורמט תגובה לא נתמך");
        }

    } catch (err) {
        addMessage("model", "שגיאה: " + err.message);
    }
}

function addMessage(role, text) {

    const chat = document.getElementById("chat");

    const bubble = document.createElement("div");
    bubble.className =
        role === "user"
        ? "bg-white text-black p-3 rounded-xl max-w-md self-end ml-auto"
        : "bg-gray-900 border border-gray-700 p-3 rounded-xl max-w-md";

    bubble.textContent = text;
    chat.appendChild(bubble);
    chat.scrollTop = chat.scrollHeight;
}

function addImage(mime, base64) {

    const chat = document.getElementById("chat");

    const wrapper = document.createElement("div");
    wrapper.className =
        "bg-gray-900 border border-gray-700 p-3 rounded-xl max-w-md";

    const img = document.createElement("img");
    img.src = `data:${mime};base64,${base64}`;
    img.className = "rounded-xl max-w-full";

    wrapper.appendChild(img);
    chat.appendChild(wrapper);
    chat.scrollTop = chat.scrollHeight;
}
</script>

</body>
</html>
